<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音频播放器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
            background: #ffffff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .player-container {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            max-width: 800px;
            width: 100%;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .header {
            background: #ffffff;
            color: #000000;
            padding: 24px 30px;
            border-bottom: 2px solid #dd5b56;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #000000;
        }

        .header p {
            color: #666666;
            font-size: 13px;
            font-weight: 400;
        }

        .lyrics-container {
            height: 450px;
            overflow-y: auto;
            padding: 20px 30px;
            background: #ffffff;
        }

        .verse {
            padding: 12px 16px;
            margin-bottom: 8px;
            background: #ffffff;
            border-left: 3px solid #e0e0e0;
            transition: all 0.2s ease;
            cursor: pointer;
            line-height: 1.6;
        }

        .verse:hover {
            background: #f5f5f5;
            border-left-color: #dd5b56;
        }

        .verse.active {
            background: #dd5b56;
            color: white;
            border-left-color: #000000;
        }

        .verse-number {
            display: inline-block;
            font-weight: 600;
            margin-right: 8px;
            min-width: 24px;
            color: #666;
        }

        .verse.active .verse-number {
            color: white;
        }

        .controls {
            padding: 24px 30px;
            background: #fafafa;
            border-top: 1px solid #e0e0e0;
        }

        .progress-container {
            margin-bottom: 16px;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .progress {
            height: 100%;
            background: #dd5b56;
            border-radius: 2px;
            width: 0%;
            transition: width 0.1s linear;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .button-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        button {
            background: #f5f5f5;
            color: #333333;
            border: 1px solid #e0e0e0;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        button:hover {
            background: #dd5b56;
            color: white;
            border-color: #dd5b56;
        }

        button:active {
            transform: scale(0.98);
        }

        .play-btn {
            padding: 14px 32px;
            font-size: 15px;
            background: #ffffff;
            color: #dd5b56;
            border: 2px solid #dd5b56;
        }

        .play-btn:hover {
            background: #dd5b56;
            color: #ffffff;
        }

        .lyrics-container::-webkit-scrollbar {
            width: 6px;
        }

        .lyrics-container::-webkit-scrollbar-track {
            background: #f5f5f5;
        }

        .lyrics-container::-webkit-scrollbar-thumb {
            background: #dd5b56;
            border-radius: 3px;
        }

        .lyrics-container::-webkit-scrollbar-thumb:hover {
            background: #c74d49;
        }
    </style>
</head>
<body>
    <div class="player-container">
        <div class="header">
            <h1>马太福音 第20章</h1>
            <p>华语有声戏剧圣经</p>
        </div>

        <div class="lyrics-container" id="lyricsContainer"></div>

        <div class="controls">
            <div class="progress-container">
                <div class="progress-bar" id="progressBar">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="time-display">
                    <span id="currentTime">0:00</span>
                    <span id="duration">0:00</span>
                </div>
            </div>

            <div class="button-group">
                <button onclick="skipBackward()">⏮ -10s</button>
                <button class="play-btn" id="playBtn" onclick="togglePlay()">▶ 播放</button>
                <button onclick="skipForward()">+10s ⏭</button>
            </div>
        </div>
    </div>

    <audio id="audio" src="downloads/mat.20_华语有声戏剧圣经.mp3" preload="auto"></audio>

    <script>
        const lyricsData = "1$0.00-9.17\n2$9.17-14.23\n3$14.23-18.26\n4$18.26-26.01\n5$26.01-30.09\n6$30.09-38.24\n7$38.24-45.25\n8$45.25-54.02\n9$54.02-58.29\n10$58.29-65.24\n11$65.24-68.22\n12$68.22-76.17\n13$76.17-85.22\n14$85.22-91.17\n15$91.17-99.16\n16$99.16-111.22\n17$111.22-120.05\n18$120.05-129.25\n19$129.25-141.20\n20$141.20-150.14\n21$150.14-163.00\n22$163.00-175.00\n23$175.00-186.23\n24$186.23-191.20\n25$191.20-203.19\n26$203.19-211.22\n27$211.22-215.17\n28$215.17-225.16\n29$225.16-231.00\n30$231.00-243.04\n31$243.04-256.12\n32$256.12-261.02\n33$261.02-266.10\n34$266.10-280.99";

        const verseTexts = {
            1: "因为天国好像家主清早去雇人进他的葡萄园做工，",
            2: "和工人讲定一天一钱银子，就打发他们进葡萄园去。",
            3: "约在巳初出去，看见市上还有闲站的人，",
            4: "就对他们说：'你们也进葡萄园去，所当给的，我必给你们。'他们也进去了。",
            5: "约在午正和申初又出去，也是这样行。",
            6: "约在酉初出去，看见还有人站在那里，就问他们说：'你们为什么整天在这里闲站呢？'",
            7: "他们说：'因为没有人雇我们。'他说：'你们也进葡萄园去。'",
            8: "到了晚上，园主对管事的说：'叫工人都来，给他们工钱，从后来的起，到先来的为止。",
            9: "约在酉初雇的人来了，各人得了一钱银子。",
            10: "及至那先雇的来了，他们以为必要多得；谁知也是各得一钱。",
            11: "他们得了，就埋怨家主说：",
            12: "'我们整天劳苦受热，那后来的只做了一小时，你竟叫他们和我们一样吗？'",
            13: "家主回答其中的一人说：'朋友，我不亏负你，你与我讲定的不是一钱银子吗？",
            14: "拿你的走吧！我给那后来的和给你一样，这是我愿意的。",
            15: "我的东西难道不可随我的意思用吗？因为我作好人，你就红了眼吗？'",
            16: "这样，那在后的，将要在前；在前的，将要在后了。",
            17: "耶稣上耶路撒冷去的时候，在路上把十二个门徒带到一边，对他们说：",
            18: "看哪，我们上耶路撒冷去，人子要被交给祭司长和文士。他们要定他死罪，",
            19: "又交给外邦人，将他戏弄，鞭打，钉在十字架上；第三日他要复活。",
            20: "那时，西庇太儿子的母亲同她两个儿子上前来拜耶稣，求他一件事。",
            21: "耶稣说：你要什么呢？她说：愿你叫我这两个儿子在你国里，一个坐在你右边，一个坐在你左边。",
            22: "耶稣回答说：你们不知道所求的是什么；我将要喝的杯，你们能喝吗？他们说：我们能。",
            23: "耶稣说：我所喝的杯，你们必要喝；只是坐在我的左右，不是我可以赐的，乃是我父为谁预备的，就赐给谁。",
            24: "那十个门徒听见，就恼怒他们弟兄二人。",
            25: "耶稣叫了他们来，说：你们知道外邦人有君王为主治理他们，有大臣操权管束他们。",
            26: "只是在你们中间，不可这样；你们中间谁愿为大，就必作你们的用人；",
            27: "谁愿为首，就必作你们的仆人。",
            28: "正如人子来，不是要受人的服侍，乃是要服侍人，并且要舍命，作多人的赎价。",
            29: "他们出耶利哥的时候，有极多的人跟随他。",
            30: "有两个瞎子坐在路旁，听说是耶稣经过，就喊着说：主啊，大卫的子孙，可怜我们吧！",
            31: "众人责备他们，不许他们作声；他们却越发喊着说：主啊，大卫的子孙，可怜我们吧！",
            32: "耶稣就站住，叫他们来，说：要我为你们做什么？",
            33: "他们说：主啊，要我们的眼睛能看见！",
            34: "耶稣就动了慈心，把他们的眼睛一摸，他们立刻看见，就跟从了耶稣。"
        };

        const lyrics = lyricsData.trim().split('\n').map(line => {
            const parts = line.split('$');
            const verse = parts[0];
            const times = parts[1].split('-');
            return { 
                verse: parseInt(verse), 
                start: parseFloat(times[0]), 
                end: parseFloat(times[1]) 
            };
        });

        const audio = document.getElementById('audio');
        const playBtn = document.getElementById('playBtn');
        const progress = document.getElementById('progress');
        const progressBar = document.getElementById('progressBar');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        const lyricsContainer = document.getElementById('lyricsContainer');

        function initLyrics() {
            lyrics.forEach(item => {
                const div = document.createElement('div');
                div.className = 'verse';
                div.dataset.verse = item.verse;
                div.dataset.start = item.start;
                div.innerHTML = '<span class="verse-number">' + item.verse + '</span>' + (verseTexts[item.verse] || '');
                div.onclick = () => seekToVerse(item.start);
                lyricsContainer.appendChild(div);
            });
        }

        function togglePlay() {
            if (audio.paused) {
                audio.play();
                playBtn.innerHTML = '⏸ 暂停';
            } else {
                audio.pause();
                playBtn.innerHTML = '▶ 播放';
            }
        }

        function seekToVerse(time) {
            const targetTime = Number(time);
            
            if (isNaN(targetTime)) {
                console.error('Invalid time value:', time);
                return;
            }
            
            // 等待音频完全加载
            if (audio.readyState < 4) {
                console.log('Waiting for audio to load completely...');
                audio.addEventListener('canplaythrough', function onReady() {
                    audio.removeEventListener('canplaythrough', onReady);
                    seekToVerse(time);
                }, { once: true });
                return;
            }
            
            // 检查 seekable 范围
            if (audio.seekable.length === 0 || audio.seekable.end(0) === 0) {
                console.warn('Audio not seekable yet, trying anyway...');
            }
            
            audio.currentTime = targetTime;
            
            if (audio.paused) {
                audio.play();
                playBtn.innerHTML = '⏸ 暂停';
            }
        }

        function skipForward() {
            audio.currentTime = Math.min(audio.currentTime + 10, audio.duration);
        }

        function skipBackward() {
            audio.currentTime = Math.max(audio.currentTime - 10, 0);
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }

        audio.addEventListener('timeupdate', () => {
            const percent = (audio.currentTime / audio.duration) * 100;
            progress.style.width = percent + '%';
            currentTimeEl.textContent = formatTime(audio.currentTime);

            const currentVerse = lyrics.find(item => 
                audio.currentTime >= item.start && audio.currentTime < item.end
            );

            document.querySelectorAll('.verse').forEach(el => {
                el.classList.remove('active');
            });

            if (currentVerse) {
                const activeEl = document.querySelector('[data-verse="' + currentVerse.verse + '"]');
                if (activeEl) {
                    activeEl.classList.add('active');
                    activeEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        });

        audio.addEventListener('loadedmetadata', () => {
            durationEl.textContent = formatTime(audio.duration);
        });

        progressBar.addEventListener('click', (e) => {
            const rect = progressBar.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            audio.currentTime = percent * audio.duration;
        });

        audio.addEventListener('ended', () => {
            playBtn.innerHTML = '▶ 播放';
        });

        // 添加 seeking 和 seeked 事件监听用于调试
        audio.addEventListener('seeking', () => {
            console.log('Seeking event fired, currentTime:', audio.currentTime);
        });

        audio.addEventListener('seeked', () => {
            console.log('Seeked event fired, currentTime:', audio.currentTime);
        });

        initLyrics();
    </script>
</body>
</html>
